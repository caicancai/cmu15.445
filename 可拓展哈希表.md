# 可拓展哈希表

可扩展哈希是一种动态哈希方法，其中目录和桶被用于哈希数据。可扩展哈希是一个有力灵活得方法，其中哈希函数也经历动态的改变

在哈希技术中主要的特征如下：

> - 目录：目录在指针中存储桶的地址。每个目录被分配一个id，每次目录扩展时，id可能会发送变化。
> - 桶：桶用于哈希真实数据

### 可拓展哈希的基本结构

![1685628750861](C:\Users\86136\AppData\Roaming\Typora\typora-user-images\1685628750861.png)

- **目录:** 这个容器存储指向桶的指针。每个目录给定一个唯一的id，当扩张发生时`id`可能随之改变。哈希函数返回这个目录的id，这个`id`被用来指向合适的桶。$$目录的数量 = 2^{全局深度}$$

- **桶:**  它们存储哈希键。目录指向桶。如果局部深度小于全局深度时，一个桶可能包含不止一个指针指向它。

- **全局深度**：它跟目录相关联。它们表示哈希函数使用的比特位数目去分类这些键。全局深度=目录id的比特位数。

- **局部深度**：和全局深度类似，除了局部深度是跟桶关联，而不是跟目录。当桶溢出发生时，局部深度根据全局深度去决定执行的行为。局部深度通常小于等于全局深度。
- **桶分裂**：当桶的元素超过了特定的大小，那么桶分裂成两个部分。
- **目录扩容**：当桶溢出时，产生目录扩容。当溢出桶的局部深度等于全局深度时，目录扩容被执行。

### 可拓展哈希基本工作流程

![1685628786668](C:\Users\86136\AppData\Roaming\Typora\typora-user-images\1685628786668.png)

- **步骤1 – 分析数据元素：**数据元素可能以各种形式存在，比如整型，字符串，浮点数等等...当前，我们考虑整形这类数据元素，比如49。

- **步骤2 - 转换成二进制形式：**将数据元素转换为二进制形式。对于字符串元素，考虑ASCII码起始字符的对应整数，然后转换成二进制形式。因为我们是将49作为数据元素，它的二进制形式是11001。

- **步骤3-检查目录的全局深度：**假设哈希目录的全局深度是3。

- **步骤4 - 识别目录：**考虑在二进制下最低“全局深度”位，然后去匹配目录id。比如，二进制是：110001，全局深度是3，所以哈希函数会返回110**001**最后三位，即001。

- **步骤5 - 导航**：现在，访问目录id=001指向的桶。

- **步骤6 – 插入和溢出检查：**插入元素并且检查桶是否溢出。如果遇到溢出，转向步骤7和步骤8，否则转到步骤9。

- **步骤7– 处理数据插入过程中的溢出情况:**  很多情况下，当在桶里插入数据时，可能发生桶溢出。在这种情况下，我们需要采取下面合适的流程去避免误操作数据。首先，检查局部深度是否小于或等于全局深度。然后选择下述情况之一。

  > - **情况1:** 如果溢出桶的本地深度等于全局深度，那么需要执行目录扩张和桶分裂。然后全局深度和局部深度的值增加1，并且指定合适的指针。目录扩张会double哈希结果中的目录数量。
  > - **情况2:** 如果本地深度小于全局深度，那么仅仅发生桶分裂。然后仅仅把局部深度增加1。并且指定合适的指针。

![1685628914945](C:\Users\86136\Desktop\1685628914945.png)

- **步骤8-分裂桶的元素重新哈希**：在被分裂的溢出桶中呈现的元素会根据目录的全局深度进行重新哈希。
- **步骤9** - 元素被成功哈希。